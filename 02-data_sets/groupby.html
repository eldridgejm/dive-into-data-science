

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Calculations on Groups &#8212; Dive into Data Science</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupytertip.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pagestyle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
    <script src="../_static/sphinx_tabs/tabs.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Dive into Data Science</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/tools.html">
   Tools of the Trade
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/first_steps.html">
   First Steps with Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/expressions.html">
   Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/variables.html">
   Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/functions.html">
   Functions and Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/data_types.html">
   Data Types
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  NumPy and Babypandas
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arrays.html">
   Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dataframes.html">
   DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="accessing.html">
   Accessing and Sorting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="querying.html">
   Querying
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../how_to_read.html">
   How To Read This Book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   All Terms and Tips
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../genindex.html">
   Index
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/02-data_sets/groupby.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/eldridgejm/dive_into_data_science"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/eldridgejm/dive_into_data_science/issues/new?title=Issue%20on%20page%20%2F02-data_sets/groupby.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        <a class="jupyterhub-button" href="https://datahub.ucsd.edu/hub/user-redirect/git-pull?repo=https://github.com/eldridgejm/dive_into_data_science&urlpath=tree/dive_into_data_science/notebooks/book_pages/02-data_sets/groupby.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#groupby">
   GroupBy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grouping-by-multiple-columns">
   Grouping by multiple columns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#is-a-wildfire-likely-to-occur">
     Is a wildfire likely to occur?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-grouping-columns">
     Multiple grouping columns
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="calculations-on-groups">
<h1>Calculations on Groups<a class="headerlink" href="#calculations-on-groups" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://wifire.ucsd.edu/index.php/">WIFIRE Lab</a> uses footage streamed from a collection of wireless cameras across California to research and model the spread of wildfires. Suppose WIFIRE has a new camera, and they want to send it to whichever county has the largest fires – they’ve asked you calculate the average fire size for each of the counties.</p>
<p>We know from the basics of querying that we can ask for just the rows of a single county and then calculate the average fire size in acres using some of the Series calculations we’ve learned about. Let’s do this for San Diego County.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">babypandas</span> <span class="k">as</span> <span class="nn">bpd</span>

<span class="n">fires</span> <span class="o">=</span> <span class="n">bpd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/calfire-full.csv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">san_diego</span> <span class="o">=</span> <span class="n">fires</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fires</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;San Diego County&#39;</span><span class="p">]</span>
<span class="n">san_diego</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;acres&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>2217.6371112001248
</pre></div>
</div>
</div>
</div>
<p>And we could use the same pattern to find the average fire size for Yolo County.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yolo</span> <span class="o">=</span> <span class="n">fires</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fires</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Yolo County&#39;</span><span class="p">]</span>
<span class="n">yolo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;acres&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>3065.2744318888736
</pre></div>
</div>
</div>
</div>
<p>And we could write the same pattern for every county in our dataset…</p>
<p>As you can imagine, we don’t want this process to be so manual. Namely, it’ll take a ton of time to write, a ton of time to run, and requires us to look at the dataset and find the name of all of the counties.</p>
<p>How many counties are there again? Yikes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fires</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([&#39;Ventura County&#39;, &#39;Humboldt County&#39;, &#39;Los Angeles County&#39;,
       &#39;Del Norte County&#39;, &#39;Siskiyou County&#39;, &#39;Lassen County&#39;,
       &#39;Modoc County&#39;, &#39;El Dorado County&#39;, &#39;Placer County&#39;,
       &#39;Amador County&#39;, &#39;Tulare County&#39;, &#39;San Bernardino County&#39;,
       &#39;Trinity County&#39;, &#39;Santa Barbara County&#39;, &#39;Orange County&#39;,
       &#39;Marin County&#39;, &#39;Alpine County&#39;, &#39;Mendocino County&#39;,
       &#39;Mariposa County&#39;, &#39;Fresno County&#39;, &#39;San Benito County&#39;,
       &#39;Tehama County&#39;, &#39;Tuolumne County&#39;, &#39;Kern County&#39;,
       &#39;Riverside County&#39;, &#39;Monterey County&#39;, &#39;Nevada County&#39;,
       &#39;Sierra County&#39;, &#39;Shasta County&#39;, &#39;Calaveras County&#39;,
       &#39;San Luis Obispo County&#39;, &#39;Colusa County&#39;, &#39;San Diego County&#39;,
       &#39;Lake County&#39;, &#39;Sacramento County&#39;, &#39;Alameda County&#39;,
       &#39;Merced County&#39;, &#39;Sonoma County&#39;, &#39;Butte County&#39;, &#39;Plumas County&#39;,
       &#39;Madera County&#39;, &#39;Yuba County&#39;, &#39;Santa Clara County&#39;,
       &#39;Yolo County&#39;, &#39;Stanislaus County&#39;, &#39;San Joaquin County&#39;,
       &#39;Napa County&#39;, &#39;Kings County&#39;, &#39;Glenn County&#39;, &#39;Solano County&#39;,
       &#39;Santa Cruz County&#39;, &#39;Contra Costa County&#39;, &#39;Mono County&#39;,
       &#39;Inyo County&#39;, &#39;San Mateo County&#39;, &#39;Sutter County&#39;,
       &#39;Imperial County&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Fortunately, this pattern is common enough that it has a special function to carry it out.</p>
<div class="section" id="groupby">
<h2>GroupBy<a class="headerlink" href="#groupby" title="Permalink to this headline">¶</a></h2>
<p>Whenever we want to perform a calculation on all the rows that belong to a single <em>group</em>, and we want to perform that calculation across all of our groups, we can use the <code class="docutils literal notranslate"><span class="pre">.groupby</span></code> function.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>.groupby(&#39;<span class="p">&lt;</span><span class="nt">column_name</span><span class="p">&gt;</span>&#39;).<span class="p">&lt;</span><span class="nt">calculation</span><span class="p">&gt;</span>()
</pre></div>
</div>
<p>When we call <code class="docutils literal notranslate"><span class="pre">.groupby</span></code> on a DataFrame, we pass a column name as the argument and are essentially telling Babypandas to split up our DataFrame based on the values of that column. Any rows which have the same value in that column will show up in the same group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fires</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;babypandas.bpd.DataFrameGroupBy at 0x7f1f461ed5c0&gt;
</pre></div>
</div>
</div>
</div>
<p>We don’t get a table back when doing this step. Instead, we get a special type of object which serves as a placeholder for the next step.</p>
<p>The groupby object owns a handful of methods that we can use to perform calculations on each group, such as <code class="docutils literal notranslate"><span class="pre">.mean</span></code>, <code class="docutils literal notranslate"><span class="pre">.sum</span></code>, <code class="docutils literal notranslate"><span class="pre">.max</span></code>, and <code class="docutils literal notranslate"><span class="pre">.count</span></code> – the count method simply counts how many rows there are in each group. Notice that these calculations only return <em>one</em> value for each group. So once the function operates on a group all of the rows in that group essentially get condensed – or <em>aggregated</em> – into a single row. For this reason, these calculations are called <span class="target" id="index-0"></span><strong><a class="reference external" href="../glossary.html#term-aggregation-function">aggregation functions</a></strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may have already heard of ‘aggregation functions’ by some different names. If someone has ever asked for a ‘<em>summary statistic</em>’ or a ‘<em>metric</em>’, it basically means the same thing.</p>
<p>All of these terms refer to a calculation that summarizes multiple data points by using a single value.</p>
</div>
<p>Now that we know how to aggregate the acres burnt in every fire in each county into just the <em>mean</em> acres burnt, let’s try it!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fires</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>acres</th>
      <th>longitude</th>
      <th>latitude</th>
    </tr>
    <tr>
      <th>county</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Alameda County</th>
      <td>1985.641509</td>
      <td>7.056604</td>
      <td>757.203483</td>
      <td>-121.671203</td>
      <td>37.685493</td>
    </tr>
    <tr>
      <th>Alpine County</th>
      <td>1999.666667</td>
      <td>7.619048</td>
      <td>1517.332351</td>
      <td>-119.829856</td>
      <td>38.531501</td>
    </tr>
    <tr>
      <th>Amador County</th>
      <td>1978.638889</td>
      <td>7.138889</td>
      <td>1229.208012</td>
      <td>-120.627970</td>
      <td>38.416929</td>
    </tr>
    <tr>
      <th>Butte County</th>
      <td>1993.150289</td>
      <td>7.682081</td>
      <td>2459.597828</td>
      <td>-121.553252</td>
      <td>39.631383</td>
    </tr>
    <tr>
      <th>Calaveras County</th>
      <td>1985.419355</td>
      <td>7.594470</td>
      <td>967.254968</td>
      <td>-120.591731</td>
      <td>38.171606</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Tulare County</th>
      <td>1989.289157</td>
      <td>7.333333</td>
      <td>1586.134478</td>
      <td>-118.728823</td>
      <td>36.294544</td>
    </tr>
    <tr>
      <th>Tuolumne County</th>
      <td>1993.002625</td>
      <td>7.624672</td>
      <td>1755.230895</td>
      <td>-120.039946</td>
      <td>37.979617</td>
    </tr>
    <tr>
      <th>Ventura County</th>
      <td>1987.720524</td>
      <td>7.945415</td>
      <td>4470.022025</td>
      <td>-119.029593</td>
      <td>34.338391</td>
    </tr>
    <tr>
      <th>Yolo County</th>
      <td>1987.461538</td>
      <td>7.369231</td>
      <td>3065.274432</td>
      <td>-122.139110</td>
      <td>38.736881</td>
    </tr>
    <tr>
      <th>Yuba County</th>
      <td>1998.977612</td>
      <td>7.388060</td>
      <td>621.634307</td>
      <td>-121.346047</td>
      <td>39.226265</td>
    </tr>
  </tbody>
</table>
<p>57 rows × 5 columns</p>
</div></div></div>
</div>
<p>Woah there, we only wanted to look at the average acres burnt across each county but we got the average of every numeric column.</p>
<p>This is because the function called on the groupby object will indeed attempt to apply itself to all the columns. That being said, our original table also has ‘unit’ and ‘cause’ columns which both contain strings – but we’re not seeing the average cause show up because you can’t take the mean of strings! So, the aggregation function applies to all <em>possible</em> columns and just drops the rest.</p>
<p>To avoid confusion, and avoid forcing the computer to do unneccessary work, it’s a good practice to select only the columns you need before conducting the groupby – you should select the column you want to group by, and any columns you want to perform the aggregation function on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">counties_and_acres</span> <span class="o">=</span> <span class="n">fires</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="s1">&#39;acres&#39;</span><span class="p">])</span>
<span class="n">counties_and_acres</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acres</th>
    </tr>
    <tr>
      <th>county</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Alameda County</th>
      <td>757.203483</td>
    </tr>
    <tr>
      <th>Alpine County</th>
      <td>1517.332351</td>
    </tr>
    <tr>
      <th>Amador County</th>
      <td>1229.208012</td>
    </tr>
    <tr>
      <th>Butte County</th>
      <td>2459.597828</td>
    </tr>
    <tr>
      <th>Calaveras County</th>
      <td>967.254968</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>Tulare County</th>
      <td>1586.134478</td>
    </tr>
    <tr>
      <th>Tuolumne County</th>
      <td>1755.230895</td>
    </tr>
    <tr>
      <th>Ventura County</th>
      <td>4470.022025</td>
    </tr>
    <tr>
      <th>Yolo County</th>
      <td>3065.274432</td>
    </tr>
    <tr>
      <th>Yuba County</th>
      <td>621.634307</td>
    </tr>
  </tbody>
</table>
<p>57 rows × 1 columns</p>
</div></div></div>
</div>
<p>Much better.</p>
<p>Finally, it’s important to notice what’s going on with our table index.</p>
<p>When we loaded in our data set we set the table index to the ‘name’ column, but once we conducted the groupby the table index has changed to the ‘county’ column. In fact, whenever we call groupby, the index will always be replaced by the grouping column.</p>
<p>This is fortunate, since it allows us to very easily get the value for a specific group!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fire_sizes</span> <span class="o">=</span> <span class="n">counties_and_acres</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fire_sizes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;San Diego County&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>acres    2217.637111
Name: San Diego County, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>And we can now use the same sort-and-grab-the-first-index pattern we covered earlier in order to find the county with the largest average fire size.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fire_sizes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;acres&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>acres    5004.534549
Name: Lake County, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
<p>Question</p>
</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
<p>Answer</p>
</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<p>If we were to run <code class="docutils literal notranslate"><span class="pre">fires.groupby('county').max()</span></code> (without first selecting a subset of the columns) which columns would we expect to remain or disappear from the result?</p>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<p>The name index will disappear and be replaced by county, all other columns will remain because the max can be calculated on a collection of numbers and max can be calculated on a collection of strings!</p>
</div>
</div>
</div>
<div class="section" id="grouping-by-multiple-columns">
<h2>Grouping by multiple columns<a class="headerlink" href="#grouping-by-multiple-columns" title="Permalink to this headline">¶</a></h2>
<p>The WIFIRE Lab is greatful for you assistance, and they have another task for you. They’re trying out a a new camera with the capability to detect fires at the edge.[^edge: Basically, instead of sending their video back to a data center that processes it to check for fires, those fire-detecting algorithms are run on the camera itself. That way, instead of sending back lots of video it can just send back whether it sees a fire or not.] [They’re going to deploy the camera for one month, and then collect it again for some reason].</p>
<div class="section" id="is-a-wildfire-likely-to-occur">
<h3>Is a wildfire likely to occur?<a class="headerlink" href="#is-a-wildfire-likely-to-occur" title="Permalink to this headline">¶</a></h3>
<p>Since they’re hoping that the experimental camera will actually witness a wildfire, but they can only have the camera deployed for one month, they want to find out which combination of county <em>and</em> month is most likely to experience a fire. WIFIRE has again asked you to perform these calculations. But how do we find the combination with the greatest <span class="target" id="index-1"></span><strong><a class="reference external" href="../glossary.html#term-likelihood">likelihood</a></strong> of a fire?</p>
<p>Suprise! Here’s out first official introduction to statistics. In order to calculate which combination of county and month is most <em>likely</em> to experience a fire, frequentist statistics would dictate that we should find which combination has the greatest <em>incidence</em> (occurrence) of fires.</p>
</div>
<div class="section" id="multiple-grouping-columns">
<h3>Multiple grouping columns<a class="headerlink" href="#multiple-grouping-columns" title="Permalink to this headline">¶</a></h3>
<p>This calculation involves us counting the number of fires that took place in each county… for each month. Sounds like groupby but with an additional level. Indeed, we can use groupby to create groups out of <em>combinations</em> of columns by passing a list of column names to the <code class="docutils literal notranslate"><span class="pre">.groupby</span></code> function.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>.groupby([<span class="p">&lt;</span><span class="nt">list_of_column_names</span><span class="p">&gt;</span>, <span class="p">&lt;</span><span class="nt">...</span><span class="p">&gt;</span>]).<span class="p">&lt;</span><span class="nt">calculation</span><span class="p">&gt;</span>()
</pre></div>
</div>
<p>Similar to before, we’re telling Babypandas to split up our rows based on the values of <em>both</em> (all) the columns we specify. Then, every row which has the same value in <em>both</em> (all) of the grouping columns will be put into the same group. Everything else remains the same, including our use of an aggregation function. Simply the way the groups were constructed now depends on multiple columns instead of just one.</p>
<p>So, let’s go ahead and use the <code class="docutils literal notranslate"><span class="pre">.count</span></code> aggregation function to get the number of fires which historically occurred in each county for each month.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fire_incidence</span> <span class="o">=</span> <span class="n">fires</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">fire_incidence</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>year</th>
      <th>unit</th>
      <th>cause</th>
      <th>acres</th>
      <th>longitude</th>
      <th>latitude</th>
    </tr>
    <tr>
      <th>county</th>
      <th>month</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">Alameda County</th>
      <th>5</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>14</td>
      <td>14</td>
      <td>14</td>
      <td>14</td>
      <td>14</td>
      <td>14</td>
    </tr>
    <tr>
      <th>7</th>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
    </tr>
    <tr>
      <th>8</th>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">Yuba County</th>
      <th>6</th>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>28</td>
    </tr>
    <tr>
      <th>7</th>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
    </tr>
    <tr>
      <th>8</th>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
    </tr>
    <tr>
      <th>9</th>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
    </tr>
    <tr>
      <th>10</th>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
<p>536 rows × 6 columns</p>
</div></div></div>
</div>
<p><strong><font color=blue>How should we explain which column to select if using count?</font></strong></p>
<p>Just like before, the table index will will replaced by the grouping columns. So, this time there are two(!) levels to the index. In the table above each county will have a maximum of twelve rows assigned to it – one for each month. It looks like Alameda County never had a recorded fire take place before May.</p>
<p>If the hierarchical nature of the index is making things too confusing, we can always ‘reset’ the index so that the values in the index become columns again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fire_incidence</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>county</th>
      <th>month</th>
      <th>year</th>
      <th>unit</th>
      <th>cause</th>
      <th>acres</th>
      <th>longitude</th>
      <th>latitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alameda County</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alameda County</td>
      <td>6</td>
      <td>14</td>
      <td>14</td>
      <td>14</td>
      <td>14</td>
      <td>14</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alameda County</td>
      <td>7</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alameda County</td>
      <td>8</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alameda County</td>
      <td>9</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>531</th>
      <td>Yuba County</td>
      <td>6</td>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>28</td>
    </tr>
    <tr>
      <th>532</th>
      <td>Yuba County</td>
      <td>7</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>26</td>
    </tr>
    <tr>
      <th>533</th>
      <td>Yuba County</td>
      <td>8</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
    </tr>
    <tr>
      <th>534</th>
      <td>Yuba County</td>
      <td>9</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
    </tr>
    <tr>
      <th>535</th>
      <td>Yuba County</td>
      <td>10</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
<p>536 rows × 8 columns</p>
</div></div></div>
</div>
<p>Let’s conclude this section by finally answering the question posed to us – which county and month should we send the camera to such that we’ll have the greatest likelihood of observing a wildfire?</p>
<p>The benefit of leaving our groupby index untouched is that it allows us to use the same sort-and-grab-the-first-index pattern again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fire_incidence</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>(&#39;Los Angeles County&#39;, 7)
</pre></div>
</div>
</div>
</div>
<p>We did it! Let’s go report back to WIFIRE that they should test out the experimental camera in Los Angeles County during July if they want the greatest likelihood of catching a wildfire.</p>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Parker Addison and Justin Eldridge<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>