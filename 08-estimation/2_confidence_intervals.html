
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Confidence Intervals &#8212; Dive into Data Science</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupytertip.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pagestyle.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hypothesis Tests for Parameters using Confidence Intervals" href="3_ht_using_intervals.html" />
    <link rel="prev" title="Parameter Estimation and Bootstrap" href="1_bootstrap.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Dive into Data Science</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/tools.html">
   Tools of the Trade
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/first_steps.html">
   First Steps with Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/expressions.html">
   Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/variables.html">
   Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-getting_started/functions.html">
   Functions and Imports
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../01-getting_started/data_types.html">
   Data Types
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../01-getting_started/data_types-numeric.html">
     Numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-getting_started/data_types-strings.html">
     Strings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-getting_started/data_types-bool.html">
     Booleans
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  NumPy and Babypandas
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../02-data_sets/arrays.html">
   Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-data_sets/dataframes.html">
   DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-data_sets/accessing.html">
   Accessing and Sorting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-data_sets/querying.html">
   Querying
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-data_sets/groupby.html">
   GroupBy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-data_sets/apply.html">
   Defining and Applying Functions
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../03-visualization/intro.html">
   Plotting with Babypandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-visualization/scatter.html">
   Scatter Plots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-visualization/line.html">
   Line graphs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-visualization/bar.html">
   Bar charts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-visualization/histogram.html">
   Bar charts
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Advanced Data Manipulation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../04-advanced_data_manipulation/merging.html">
   Merge
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Probability and Simulation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../05-probability_and_simulation/probability_and_simulation.html">
   Probability and simulation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Populations and Samples
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../06-populations_and_samples/1_populations_and_samples.html">
   Populations and Samples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06-populations_and_samples/2_parameters_and_statistics.html">
   Parameters and statistics
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Hypothesis Testing
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../07-hypothesis_testing/1_hypothesis_tests.html">
   Hypothesis Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07-hypothesis_testing/2_permutation_tests.html">
   Permutation Tests
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Estimation
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="1_bootstrap.html">
   Parameter Estimation and Bootstrap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1_bootstrap.html#our-best-guess-for-the-parameter">
   Our best guess for the parameter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1_bootstrap.html#how-different-could-our-statistic-have-been">
   How different could our statistic have been
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1_bootstrap.html#the-bootstrap">
   The bootstrap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1_bootstrap.html#the-bootstrap-isn-t-magical">
   The bootstrap isn’t magical
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1_bootstrap.html#faq-bootstrapping-versus-permuting">
   FAQ: Bootstrapping versus Permuting
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Confidence Intervals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_ht_using_intervals.html">
   Hypothesis Tests for Parameters using Confidence Intervals
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../how_to_read.html">
   How To Read This Book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   All Terms and Tips
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../genindex.html">
   Index
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/08-estimation/2_confidence_intervals.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/eldridgejm/dive_into_data_science"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/eldridgejm/dive_into_data_science/issues/new?title=Issue%20on%20page%20%2F08-estimation/2_confidence_intervals.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        <a class="jupyterhub-button" href="https://datahub.ucsd.edu/hub/user-redirect/git-pull?repo=https://github.com/eldridgejm/dive_into_data_science&urlpath=tree/dive_into_data_science/notebooks/book_pages/08-estimation/2_confidence_intervals.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#percentiles">
   Percentiles
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-percentiles-by-hand">
     Calculating percentiles by hand
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#more-information-about-percentiles">
       More information about percentiles
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-percentiles-with-numpy">
     Calculating percentiles with NumPy
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-range-of-typical-values">
   A range of typical values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#confidence">
   Confidence
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulating-confidence">
     Simulating confidence
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#different-levels-of-confidence">
     Different levels of confidence
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-bootstrapped-interval-isn-t-magical">
   The bootstrapped interval isn’t magical
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-procedures-can-exhibit-confidence">
   Other procedures can exhibit confidence
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="confidence-intervals">
<h1>Confidence Intervals<a class="headerlink" href="#confidence-intervals" title="Permalink to this headline">¶</a></h1>
<p>As a way to embrace uncertainty, we’ve come to the decision that the best way to make an estimate of a population parameter is to give our <span class="target" id="index-0"></span><strong><a class="reference external" href="../glossary.html#term-point-estimate">point estimate</a></strong>, then quickly follow it up with a <em>range</em> of possible estimates we might have given if our sample had looked different. We used <span class="target" id="index-1"></span><strong><a class="reference external" href="../glossary.html#term-bootstrapping">bootstrapping</a></strong> to come up with the distribution of possible estimates, but then we just eyeballed the range.</p>
<p>What <em>is</em> that range, what does it really mean and how do we leverage it mathematically? And, gee, what is this ‘confidence’ we keep hearing about?</p>
<div class="section" id="percentiles">
<h2>Percentiles<a class="headerlink" href="#percentiles" title="Permalink to this headline">¶</a></h2>
<p>A numerical way to look at a distribution and find the ‘most common’ range of values is to compute percentiles. Formally, the <span class="math notranslate nohighlight">\(x\)</span>th percentile is defined as “the value in the data at which <span class="math notranslate nohighlight">\(x\%\)</span> of the data is below (or equal to) that value. Some well known percentiles are:</p>
<ul class="simple">
<li><p>The 0th percentile is the minimum – no data is below this value</p></li>
<li><p>The 50th percentile is generally the median – half of the data is below the median, and half is above</p>
<ul>
<li><p>The only difference is that during the median you might average the two center values, whereas with the 50th percentile you would just choose the higher value</p></li>
</ul>
</li>
<li><p>The 100th percentile is the maximum – all data is below this value</p></li>
<li><p>The 25th and 75th percentiles are also called the first and third ‘quartiles’ – coupled coupled with the median (second quartile) these essentially split our data into four bins containing equal amounts of data</p></li>
</ul>
<p>As you can start to imagine, we can use percentiles to determine a range of ‘typical’ values in a distribution – maybe something like computing a range of values where less than <span class="math notranslate nohighlight">\(a\%\)</span> of data are below the range and less than <span class="math notranslate nohighlight">\(b\%\)</span> of data are above the range.</p>
<p>First we should dig a bit further into what percentiles are.</p>
<div class="section" id="calculating-percentiles-by-hand">
<h3>Calculating percentiles by hand<a class="headerlink" href="#calculating-percentiles-by-hand" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to understand percentiles is to calculate a couple yourself. Just like with the median, to find any percentile we start by taking some array and sorting it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Eight random numbers are in here</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">arr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([7, 2, 9, 2, 1, 6, 3, 4])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="n">arr_sorted</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1, 2, 2, 3, 4, 6, 7, 9])
</pre></div>
</div>
</div>
</div>
<p>In this sorted form, it becomes trivial to see at which value is the <span class="math notranslate nohighlight">\(x\%\)</span> largest – all we need to do is count <span class="math notranslate nohighlight">\(x\%\)</span> of the way through our array then stop.</p>
<p>To turn our percentile into a position in our array, we take <span class="math notranslate nohighlight">\(x\%\)</span> of the length of our array, <span class="math notranslate nohighlight">\(n\)</span>. In math that means consider the <span class="math notranslate nohighlight">\(x\)</span>th percentile to be the element in the <span class="math notranslate nohighlight">\((x / 100)\times n\)</span>th position of our sorted array.</p>
<p>For the example above we have <span class="math notranslate nohighlight">\(8\)</span> elements, so to find the 50th percentile we’d look for the <span class="math notranslate nohighlight">\(8\times 0.5 = 4\)</span>th element in our sorted list. That’s easy enough, we get that the 50th percentile is 3.</p>
<div class="section" id="more-information-about-percentiles">
<h4>More information about percentiles<a class="headerlink" href="#more-information-about-percentiles" title="Permalink to this headline">¶</a></h4>
<p>There are a couple quirks to percentiles that we should watch out for.</p>
<p>Only having <span class="math notranslate nohighlight">\(8\)</span> elements means that we can’t find a perfect percentile for just any old <span class="math notranslate nohighlight">\(x\%\)</span> we look at. If we wanted the 40th percentile we’d try to look for the <span class="math notranslate nohighlight">\(8\times 0.4 = 3.2\)</span>th element in our sorted list… which isn’t quite possible. In this setting we always round up to the next integer position when calculating percentiles by hand – so we’d look for the <span class="math notranslate nohighlight">\(4\)</span>th element in our sorted list and end up with the 40th percentile also equaling 3.</p>
<p>Finally, notice that we have some duplicate values in our array – namely there are two 2’s. The percentile is only concerned about the <em>amount</em> of data that lies below or equal to it, not the value itself, therefore a duplicated value like 2 could theoretically satisfy multiple percentiles. Taking this to the extreme, could you imagine if our array was <em>entirely</em> full of the value 2? Then every percentile would equal 2!</p>
<p>In practice, we’re usually calculating percentiles on arrays that aren’t so tiny, and we should always explore our data to see if possible problems will arise, so these quirks aren’t too impactful in your daily life – but they are worth remembering if you ever find yourself faced with strange percentiles!</p>
</div>
</div>
<div class="section" id="calculating-percentiles-with-numpy">
<h3>Calculating percentiles with NumPy<a class="headerlink" href="#calculating-percentiles-with-numpy" title="Permalink to this headline">¶</a></h3>
<p>As with many great things in life, NumPy can calculate percentiles for us. However, as with many things NumPy creates, their method of dealing with certain quirks is a bit different than ours.</p>
<p>The main difference is that NumPy doesn’t constrain itself to return a point directly in our data, instead it will interpolate between values to find a new point at which <span class="math notranslate nohighlight">\(x\%\)</span> of the data lies below and <span class="math notranslate nohighlight">\(100-x\%\)</span> of the data lies above. To see what this means in practice, we can look at our example array again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr_sorted</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1, 2, 2, 3, 4, 6, 7, 9])
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">np.percentile</span></code> function is used to calculate desired percentiles of an array. The first argument is the array of data, and the second is a percent we want to get the percentile for. Note that the percent we pass in <strong>should be between 0 and 100</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate a single percentile, where we pass in a percent between 0-100</span>
<span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.5
</pre></div>
</div>
</div>
</div>
<p>Before we calculated by hand that the 50th percentile was 3, but NumPy uses interpolation to decide that a slightly better percentile can be found by averaging the two values, 3 and 4, which equally split the data into two halves – this results in the median we’re so used to.</p>
<p>Once again, in practice our data should be sufficiently large that these differences in computation don’t truly make much of a difference in result.</p>
</div>
</div>
<div class="section" id="a-range-of-typical-values">
<h2>A range of typical values<a class="headerlink" href="#a-range-of-typical-values" title="Permalink to this headline">¶</a></h2>
<p>In our bootstrapping example, we generated a distribution of possible estimates we could have made if our sample distribution came out a bit differently. We then chose to predict not just the point estimate, but to also augment our estimate by looking at what values we would have commonly estimated if our sample looked different. We say something along the lines of “I wouldn’t be surprised if the true population parameter is somewhere in this range of typical values, since I recognize that my sample might look different each time!”</p>
<p>Finding a range of values where the true parameter may lie is called producing an <span class="target" id="index-2"></span><strong><a class="reference external" href="../glossary.html#term-interval-estimate">interval estimate</a></strong>.</p>
<p>Using percentiles, we can formally and mathematically find that range of ‘typical’ point estimates by grabbing the range of the <em>middle</em> <span class="math notranslate nohighlight">\(x\%\)</span> of the data.</p>
<p><img alt="" src="../_images/middle-95-pct.png" /></p>
<p>Another way we can think about this is by looking at the two percents on each side of our distribution of bootstrapped estimates. Each side only contains <span class="math notranslate nohighlight">\(\frac{100-x}{2}\%\)</span> of the data – in other words, these values were pretty uncommon!</p>
<p><img alt="" src="../_images/sides-95-pct.png" /></p>
<p>And so, to find the range of the <span class="math notranslate nohighlight">\(x\%\)</span> most common values of a distribution, we can set the lower and upper percentiles.</p>
<p>Let’s calculate it! Remember our bootstrapped estimates of the median salary? I’ve saved it to a file we can load in so we can find the middle 95% range ourselves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">babypandas</span> <span class="k">as</span> <span class="nn">bpd</span>
<span class="n">boot_medians</span> <span class="o">=</span> <span class="n">bpd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../data/bootstrapped_median_salary_estimates.csv&#39;</span><span class="p">)</span>
<span class="n">boot_medians</span> <span class="o">=</span> <span class="n">boot_medians</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Estimate&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Remember, to find the middle 95%, we’ll need to recognize that leaves <span class="math notranslate nohighlight">\(100-95=5\%\)</span> outside of the middle, and therefore <span class="math notranslate nohighlight">\(2.5\%\)</span> on each side – so we’ll calculate the lower end of our range as the 2.5th percentile and the upper end of our range as the 97.5th percentile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_medians</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_medians</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The most typical 95</span><span class="si">% o</span><span class="s1">f our bootstrapped estimates land between&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The most typical 95% of our bootstrapped estimates land between 97500.0 and 120000.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="confidence">
<h2>Confidence<a class="headerlink" href="#confidence" title="Permalink to this headline">¶</a></h2>
<p>So where does this talk of ‘confidence’ come in? When we create a distribution of bootstrapped estimates and find the middle <span class="math notranslate nohighlight">\(x\%\)</span> of typical values, the range of these typical values is called <em>a <span class="math notranslate nohighlight">\(x\%\)</span> <span class="target" id="index-3"></span><strong><a class="reference external" href="../glossary.html#term-confidence-interval">confidence interval</a></strong></em>. So, above we created a 95% confidence interval for the population median salary.</p>
<p>Why do we bring in ‘confidence’? It turns out that <span class="math notranslate nohighlight">\(x\%\)</span> of the time we take a random sample, bootstrap it, then calculate the <span class="math notranslate nohighlight">\(x\%\)</span> confidence interval, that range of values will successfully capture the true population parameter!</p>
<p>In other words, we can be <span class="math notranslate nohighlight">\(x\%\)</span> <em>confident</em> that the process which generated our interval produced an interval which includes the true parameter.</p>
<p>What!?</p>
<p>To illustrate what this means, let’s try it out.</p>
<div class="section" id="simulating-confidence">
<h3>Simulating confidence<a class="headerlink" href="#simulating-confidence" title="Permalink to this headline">¶</a></h3>
<p>As skeptical data scientists, let’s put that claim to the test by relying on some good ol’ simulation.</p>
<p>Our <em>process</em> which generates CI’s in this case is bootstrapping the median: we take a sample from the population, compute bootstrapped estimates for the median, then find the middle 95% of those estimates.</p>
<p>We can repeat this process a bunch of times, each time using a different sample. Then we’ll peek at how many of the generated intervals successfully capture the true median.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">trials</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates bootstrapped median estimates from a sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Remember, each resample should be the same size as the original sample</span>
    <span class="n">sample_size</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">boot_medians</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        
        <span class="c1"># Remember to specify replacement!</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Calculate the median salary of each resample and add to our collection</span>
        <span class="n">boot_medians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resample</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Salary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">boot_medians</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">population</span> <span class="o">=</span> <span class="n">bpd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../data/salaries.csv&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Salary&#39;</span><span class="p">])</span>
<span class="n">pop_median</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Salary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

<span class="n">interval_lowers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">interval_uppers</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Do a bunch of times</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    
    <span class="c1"># Create a brand new sample from the population</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># Create a bunch of bootstrapped statistics from this sample</span>
    <span class="n">boot_medians</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># Calculate the 95% confidence interval on the bootstrapped statistics</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_medians</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_medians</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>
    
    <span class="n">interval_lowers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
    <span class="n">interval_uppers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we’ve created our intervals from the bootstrapped medians, what proportion of them were able to capture the population median?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remember, since we&#39;re doing element-wise logic we use the &amp; operator</span>
<span class="n">is_contained</span> <span class="o">=</span> <span class="p">(</span><span class="n">interval_lowers</span> <span class="o">&lt;=</span> <span class="n">pop_median</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pop_median</span> <span class="o">&lt;=</span> <span class="n">interval_uppers</span><span class="p">)</span>

<span class="c1"># Our is_contained array is an array of True and False, we can find the</span>
<span class="c1"># proportion of True by taking the mean!</span>
<span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">is_contained</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also visualize all of our intervals by stacking them on top of each other on a number line, and see which ones cross the true population median or not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># You&#39;re by no means not obligated to know how to produce this code, but it&#39;s</span>
<span class="c1"># great practice to try to understand what we&#39;re doing!</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Let&#39;s only draw 100 since 500 would be a *lot* in one graph :)</span>
<span class="n">num_to_draw</span> <span class="o">=</span> <span class="mi">100</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_draw</span><span class="p">):</span>

    <span class="n">lower</span> <span class="o">=</span> <span class="n">interval_lowers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">interval_uppers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># If the population median isn&#39;t in the interval we&#39;ll color it red</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">pop_median</span> <span class="o">&lt;=</span> <span class="n">upper</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;skyblue&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
    
    <span class="c1"># Each interval is drawn as a line from lower to upper, and its height is</span>
    <span class="c1"># based on which trial number generated it.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    
<span class="c1"># Draw the true population median</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pop_median</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;True population median and 95</span><span class="si">% c</span><span class="s1">onfidence intervals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Median salary&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Trial number&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>All of this goes to show that taking the middle 95% of bootstrapped medians is a process which we’re confident will produce a good interval roughly 95% of the time.</p>
<p>For more exploration, check out <a class="reference external" href="https://seeing-theory.brown.edu/frequentist-inference/index.html#section2">this interactive visualization of Confidence Intervals and Bootstrapping from Brown University</a>.</p>
</div>
<div class="section" id="different-levels-of-confidence">
<h3>Different levels of confidence<a class="headerlink" href="#different-levels-of-confidence" title="Permalink to this headline">¶</a></h3>
<p>Because we can exhibit confidence in our bootstrapped median process (we just showed it experimentally), we can look at other levels of confidence besides just 95%.</p>
<p>A process which generates 80% confidence intervals may produce narrower intervals on average, which could be nice, but we’d only expect it to produce good intervals 80% of the time.</p>
<p>Say we wanted to use a process which generates 100% confidence intervals – we’d expect that 100% of the intervals produced would capture the true population parameter. Sounds great, right?</p>
<p>Not quite. As our confidence increases, so to on average does the width of our intervals. For example, one way of creating 100% confidence intervals is by just guessing that the parameter is within the range from <span class="math notranslate nohighlight">\(-\infty\)</span> to positive <span class="math notranslate nohighlight">\(\infty\)</span>… which isn’t all that useful of an estimation anymore.</p>
<p>We can totally use high confidence levels if we want to make sure our estimate has a better chance of being correct. Just don’t try to set your confidence level to 100%.</p>
</div>
</div>
<div class="section" id="the-bootstrapped-interval-isn-t-magical">
<h2>The bootstrapped interval isn’t magical<a class="headerlink" href="#the-bootstrapped-interval-isn-t-magical" title="Permalink to this headline">¶</a></h2>
<p>Not all metrics will produce useful intervals when bootstrapped.</p>
<p>For example, if we wanted to estimate the population maximum, using the sample max as our estimate and bootstrapping this could help us get a sense of how much a sample max may vary, but it absolutely cannot produce an interval whose upper bound is greater than the sample max! So if our original sample doesn’t contain the population max, then neither can our interval.</p>
<p>Creating intervals with bootstrapped metrics and percentiles works best if there’s reason to believe the true sampling distribution of that metric is roughly symmetrical and bell shaped.</p>
</div>
<div class="section" id="other-procedures-can-exhibit-confidence">
<h2>Other procedures can exhibit confidence<a class="headerlink" href="#other-procedures-can-exhibit-confidence" title="Permalink to this headline">¶</a></h2>
<p>There’s nothing inherent about an interval itself which makes it a confidence interval. Basically: if you read <span class="math notranslate nohighlight">\((13.5, 21.8)\)</span> there’s nothing you can say about that particular interval of numbers which makes it good or bad. Rather, it’s the <em>process</em> which generated the interval which we have confidence in.</p>
<p>It so happens that grabbing the middle <span class="math notranslate nohighlight">\(x\%\)</span> of bootstrapped medians is a process we are confident in, same with for the bootstrapped means, or variances, or many other metrics and estimators. But, trying to apply this to another metric which the bootstrap is not so great at, such as the maximum, will result in a process we are <em>not</em> confident in.</p>
<p>There are a multitude of different processes <em>besides</em> bootstrapping that can produce interval estimates – many of which are processes that we have confidence in! We’ll cover this in the chapter about the Normal Curve and the Central Limit Theorem.</p>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="1_bootstrap.html" title="previous page">Parameter Estimation and Bootstrap</a>
    <a class='right-next' id="next-link" href="3_ht_using_intervals.html" title="next page">Hypothesis Tests for Parameters using Confidence Intervals</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Parker Addison and Justin Eldridge<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>